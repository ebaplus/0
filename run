# Provjera instaliranih aplikacija
$keywords = @("asseco", "signergy", "unicredit", "e-baplus", "scmanagment", "safenet")
$uninstallPaths = @(
    "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*",
    "HKLM:\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*"
)
$foundApps = @()
foreach ($path in $uninstallPaths) {
    $apps = Get-ItemProperty $path -ErrorAction SilentlyContinue
    foreach ($app in $apps) {
        $name = $app.DisplayName
        $version = $app.DisplayVersion
        if ($name) {
            foreach ($keyword in $keywords) {
                if ($name.ToLower().Contains($keyword)) {
                    $foundApps += "$name - Verzija: $version"
                    break
                }
            }
        }
    }
}


chcp 65001 > $null
[Console]::OutputEncoding = [System.Text.UTF8Encoding]::new()

Clear-Host

# Simple blocky header using plain characters
Write-Host "==============================" -ForegroundColor Green
Write-Host " EbaPlus Automatski Installer " -ForegroundColor Green
Write-Host "==============================" -ForegroundColor Green
Write-Host ""

# Highlighted path text
Write-Host -NoNewline "Kreirali smo folder " -ForegroundColor Green
Write-Host -NoNewline "C:\eba" -ForegroundColor Yellow
Write-Host " unutar kojeg će se nalaziti sve potrebne instalacije, upute i linkovi.`n" -ForegroundColor Green

# Create folder
$dest = "C:\eba"
New-Item -ItemType Directory -Force -Path $dest | Out-Null

# Architecture detection (silent)
$is64Bit = [Environment]::Is64BitOperatingSystem
$logPath = "$dest\log.txt"
Add-Content $logPath "`n[$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')] Sistem: $([Int]$is64Bit * 32 + 32)-bitni OS detektovan."

# Zapis instaliranih aplikacija u log
if ($foundApps.Count -gt 0) {
    Add-Content $logPath "`n[INFO] Pronađene instalacije:"
    $foundApps | ForEach-Object { Add-Content $logPath " - $_" }
} else {
    Add-Content $logPath "`n[INFO] Nisu pronađene nijedne od traženih instalacija."
}

# Ask question
$choice = Read-Host "Instalacija podrske za Karticu(K) ili za USB(U) [Default: USB]"
$choice = ($choice + "").ToLower()
